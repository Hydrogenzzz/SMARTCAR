/*********************************************************************************************************************
 * TC264 Opensourec Library ����TC264 ��Դ�⣩��һ�����ڹٷ� SDK �ӿڵĵ�������Դ��
 * Copyright (c) 2022 SEEKFREE ��ɿƼ�
 *
 * ���ļ��� TC264 ��Դ���һ����
 *
 * TC264 ��Դ�� ���������
 * �����Ը���������������ᷢ���� GPL��GNU General Public License���� GNUͨ�ù�������֤��������
 * �� GPL �ĵ�3�棨�� GPL3.0������ѡ��ģ��κκ����İ汾�����·�����/���޸���
 *
 * ����Դ��ķ�����ϣ�����ܷ������ã�����δ�������κεı�֤
 * ����û�������������Ի��ʺ��ض���;�ı�֤
 * ����ϸ����μ� GPL
 *
 * ��Ӧ�����յ�����Դ���ͬʱ�յ�һ�� GPL �ĸ���
 * ���û�У������<https://www.gnu.org/licenses/>
 *
 * ����ע����
 * ����Դ��ʹ�� GPL3.0 ��Դ����֤Э�� ������������Ϊ���İ汾
 * ��������Ӣ�İ��� libraries/doc �ļ����µ� GPL3_permission_statement.txt �ļ���
 * ����֤������ libraries �ļ����� �����ļ����µ� LICENSE �ļ�
 * ��ӭ��λʹ�ò����������� ���޸�����ʱ���뱣����ɿƼ��İ�Ȩ����������������
 *
 * �ļ�����          cpu0_main
 * ��˾����          �ɶ���ɿƼ����޹�˾
 * �汾��Ϣ          �鿴 libraries/doc �ļ����� version �ļ� �汾˵��
 * ��������          ADS v1.9.4
 * ����ƽ̨          TC264D
 * ��������          https://seekfree.taobao.com/
 *
 * �޸ļ�¼
 * ����              ����                ��ע
 * 2022-09-15       pudding            first version
 ********************************************************************************************************************/
#pragma section all "cpu0_dsram"
#include "zf_common_headfile.h"
#include "server.h"
#include "global.h"
#include "track.h"

// ���������#pragma section all restore���֮���ȫ�ֱ���������CPU0��RAM��

// �������ǿ�Դ��չ��� ��������ֲ���߲��Ը���������
// �������ǿ�Դ��չ��� ��������ֲ���߲��Ը���������
// �������ǿ�Դ��չ��� ��������ֲ���߲��Ը���������

// **************************** �������� ****************************
char BT_String[20];
uint8_t data = 25;
/*
函数名称：int core0_main(void)
功能说明：CPU0主函数，负责系统初始化和主循环控制
参数说明：无
函数返回：理论上不会返回（无限循环），返回值类型仅为兼容系统要求
*/
int core0_main(void)
{
    // 初始化系统时钟
    clock_init(); // 获取时钟频率<自动配置>
    // 初始化默认的调试串口
    debug_init(); // 初始化默认的调试端口

    // 以下为用户代码区域：初始化各种硬件模块
    // 初始化按键列表，参数1表示支持长按功能
    key_list_init(1);
    // 设置TFT显示屏为横屏模式
    tft180_set_dir(TFT180_CROSSWISE);
    // 初始化1.8寸TFT显示屏
    tft180_init();
    // 初始化菜单系统
    menu_init(); // 菜单初始化
    // 初始化编码器
    encoder_init();
    // 初始化舵机控制
    server_init();
    // 初始化电机控制
    Motor_Init();
    // 初始化MT9V03X摄像头
    mt9v03x_init();

    // 设置摄像头曝光时间为100
    mt9v03x_set_exposure_time(100);
    Positional_PID_Init(&angle, 1.5, 0.1, 0.05, 968);
    // 初始化左电机增量式PID控制器（P=1.5, I=0.1, D=0.05, 输出限幅10000）
    Incremental_PID_Init(&left, 1.5, 0.1, 0.05, 10000);
    // 初始化右电机增量式PID控制器（P=1.5, I=0.1, D=0.05, 输出限幅10000）
    Incremental_PID_Init(&right, 1.5, 0.1, 0.05, 10000);
    // 初始化PIT定时器，用于控制舵机角度
    pit_ms_init(CCU61_CH0, 5);
    // 初始化PIT定时器，用于定时读取速度，周期5ms
    pit_ms_init(CCU60_CH1, 5); // 定时读取速度
    // 初始化PIT定时器，用于按键扫描，周期5ms
    pit_ms_init(CCU60_CH0, 5); // 按键扫描

    // 设置初始目标速度为左右轮各60
    Target_Speed_Control(60, 60); // 设定速度
    // �˴���д�û����� ���������ʼ�������
    cpu_wait_event_ready(); // �ȴ����к��ĳ�ʼ�����
    while (TRUE)
    {
        // �˴���д��Ҫѭ��ִ�еĴ���
        // key_action();
        // menu_refresh(); // ������Ϊ�˵���ʼ���ı�Ҫ����
        if (mt9v03x_finish_flag)
        {
            mt9v03x_finish_flag = 0;
            otsuThreshold(&mt9v03x_image, &bin_image);
            track_process(); // ִ巡线处理
            // 图像显示已移至track.c中的track_process函数内
        }
        // �˴���д��Ҫѭ��ִ�еĴ���
    }
}

#pragma section all restore

// **************************** �������� ****************************
